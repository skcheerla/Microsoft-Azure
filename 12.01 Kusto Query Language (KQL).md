**Kusto Query Language (KQL)** is a powerful, read-only language developed by Microsoft for querying structured, semi-structured, and unstructured data. In Azure, it is most commonly used in **Azure Monitor Logs** (Log Analytics), **Azure Data Explorer**, and **Microsoft Sentinel** for analyzing logs, metrics, and telemetry data.

KQL is designed to be easy to read and write, using a data-flow model where data is passed from one command (operator) to the next using the **pipe character** (`|`). The query generally starts with a table name and then applies filters, aggregations, and projections sequentially.

-----

## Key KQL Operators

| Operator | Purpose | SQL Equivalent |
| :--- | :--- | :--- |
| `tablename` | The starting point of the query, specifying the data source. | `FROM tablename` |
| `where` | Filters the table's rows based on a specific condition. | `WHERE` |
| `project` | Selects specific columns to include in the output. | `SELECT` |
| `summarize` | Groups data and calculates aggregations (e.g., count, sum, average). | `GROUP BY` and aggregate functions |
| `extend` | Creates a new calculated column. | N/A (similar to a calculated column in `SELECT`) |
| `order by` | Sorts the result set by one or more columns. | `ORDER BY` |
| `take` | Limits the number of rows returned. | `TOP` or `LIMIT` |

-----

## KQL Queries for Common Scenarios

Here are a few example queries using KQL to understand common Azure monitoring scenarios. These are typically run in the **Log Analytics** workspace in Azure Monitor.

### 1\. Simple Data Retrieval and Filtering

**Scenario:** Get the last 10 records from the `SecurityEvent` table that represent a successful login (EventID 4624) in the last hour.

```kql
SecurityEvent
| where TimeGenerated > ago(1h)
| where EventID == 4624
| take 10
| project TimeGenerated, Computer, Account
```

  * `SecurityEvent`: Specifies the table to query.
  * `where TimeGenerated > ago(1h)`: Filters records to only those created in the last 1 hour.
  * `where EventID == 4624`: Filters to a specific Windows Event ID for successful logons.
  * `take 10`: Limits the output to 10 records.
  * `project ...`: Selects and displays only the `TimeGenerated`, `Computer`, and `Account` columns.

### 2\. Aggregation and Time-Series Analysis

**Scenario:** Count the total number of errors (`Level == 2`) per computer over the last 7 days, grouped by day.

```kql
Heartbeat
| where TimeGenerated > ago(7d)
| summarize DailyErrorCount = countif(Computer == "Error") by bin(TimeGenerated, 1d)
| render timechart 
```

  * `Heartbeat`: Specifies the table (often used for agent status).
  * `summarize ... by bin(TimeGenerated, 1d)`: Groups the records by a 1-day interval (`bin`) and calculates a count of records where the `Computer` column equals "Error" (using `countif`).
  * `render timechart`: Displays the results as a line chart over time. (Note: The `Heartbeat` table doesn't have an error level, but this demonstrates the syntax for summarizing by time).

### 3\. Calculating Percentiles and Sorting

**Scenario:** Find the 95th percentile and average duration of application requests in the last 24 hours, grouped by the request name.

```kql
AppRequests
| where TimeGenerated > ago(24h)
| summarize 
    AvgDuration = avg(DurationMs), 
    P95Duration = percentile(DurationMs, 95), 
    TotalRequests = count()
  by OperationName
| order by P95Duration desc
```

  * `AppRequests`: Specifies the table for application request data.
  * `summarize ... by OperationName`: Groups the results by the request name and calculates the average duration, the 95th percentile duration, and the total count of requests.
  * `order by P95Duration desc`: Sorts the final result table to show the slowest requests first.

This video provides an excellent introduction to the basics and fundamental building blocks of the KQL language, which is essential for working with log data in Azure. [Kusto Query Language Tutorial | Basics | Beginner To Pro in 30 Minutes](https://www.google.com/search?q=https://www.youtube.com/watch%3Fv%3DImqRQJfnSH4)
