Azure Application Gateway is a **web traffic load balancer** (or **Application Delivery Controller - ADC**) that operates at the application layer (**OSI Layer 7**). It enables you to manage, secure, and optimize traffic destined for your web applications.

Unlike a traditional Layer 4 load balancer (like Azure Load Balancer) which routes traffic based on IP address and port, Application Gateway can make routing decisions based on attributes of the HTTP request, such as the URL path or host header.

***

## Key Features of Azure Application Gateway

The gateway provides several advanced features critical for modern web applications:

* **Web Application Firewall (WAF):** Provides centralized protection for your web applications from common web vulnerabilities and exploits like SQL injection and cross-site scripting (XSS), based on OWASP Core Rule Sets.
* **SSL/TLS Termination:** The gateway can decrypt HTTPS traffic at the edge (the gateway itself). This **offloads** the CPU-intensive encryption/decryption task from your backend web servers, improving their performance and simplifying certificate management.
* **End-to-End SSL:** It can also re-encrypt the traffic before sending it to the backend servers for maximum security.
* **URL-based Routing (Path-based Routing):** You can direct traffic to different backend server pools based on the URL path of the request (e.g., send `contoso.com/images` to a separate image server pool and `contoso.com/api` to an API server pool).
* **Multi-Site Hosting:** Allows you to host more than one web application on the same Application Gateway instance using host headers (e.g., route traffic for `www.app1.com` and `www.app2.com` to different backend pools via a single public IP).
* **Session Affinity (Sticky Sessions):** Uses cookies to ensure all requests from a specific client in a session are directed to the same backend server.
* **Autoscaling:** The $\text{v2}$ SKU can automatically scale up or down based on your web traffic load patterns.

***

## Where Application Gateway is Used (Use Cases)

Application Gateway is an ideal service for any architecture involving public-facing web applications or APIs that require advanced traffic management and security.

### Common Scenarios

| Scenario | Description | Key Feature Used |
| :--- | :--- | :--- |
| **Securing Web Apps** | Protecting public-facing web applications from malicious attacks. | **Web Application Firewall (WAF)** |
| **Hosting Multiple Sites** | Running multiple different domains or sub-domains from a single Application Gateway IP address. | **Multi-Site Hosting** |
| **Microservice Routing** | Directing users to different backend services based on the page or function they are requesting. | **URL-based Routing** |
| **Performance Optimization** | Offloading the SSL encryption/decryption workload from the web servers to the Application Gateway. | **SSL/TLS Termination** |
| **High Availability** | Ensuring all user requests are consistently sent to a healthy server instance, with session stickiness for e-commerce or login sessions. | **Health Probes, Load Balancing, Session Affinity** |

***
You can see an explanation of the Application Gateway's components, features, and workflow in this video: [Azure Application Gateway: Components, Features and Workflow Explained](https://www.youtube.com/watch?v=YvqeabrhcQE).
http://googleusercontent.com/youtube_content/1

<img width="1160" height="588" alt="image" src="https://github.com/user-attachments/assets/77beb5a6-bd3e-4ea2-8308-c6a7f730c421" />



<img width="1170" height="495" alt="image" src="https://github.com/user-attachments/assets/b054c614-47a3-494f-b26e-76070a6788fc" />


These notes provide an explanation for the key components of **Azure Application Gateway**, a Layer 7 (application layer) load balancer and application delivery controller offered as a service by Azure.

***

## What is Azure Application Gateway

The **Azure Application Gateway** is a **Layer 7 load balancer** that manages and secures web traffic to your web applications. It acts as a reverse proxy, routing client requests to the appropriate backend pool based on URL, host header, or other HTTP attributes.

**Key features include:**
* **Layer 7 Load Balancing:** Distributes HTTP/HTTPS, WebSocket, and HTTP/2 traffic.
* **Web Application Firewall (WAF):** Provides centralized protection against common web vulnerabilities and exploits (e.g., SQL Injection, Cross-Site Scripting).
* **SSL/TLS Termination (Offloading):** It can handle the encryption and decryption, reducing the load on your backend servers.
* **End-to-End TLS:** It can re-encrypt traffic before sending it to the backend servers for maximum security.
* **Session Affinity (Cookie-based):** Ensures a user's requests are always routed to the same backend server.
* **Multi-site Hosting:** Allows you to configure multiple web applications on the same Application Gateway instance.
* **URL Path-Based Routing:** Routes traffic to different backend pools based on the URL path.

***

## What are WAF Policies

A **Web Application Firewall (WAF) Policy** is a dedicated Azure resource that contains all the security settings and configurations for Application Gateway WAF.

It defines *how* the WAF protects your web applications.

**Key components of a WAF Policy:**
* **Managed Rule Sets (CRS):** Collections of pre-configured, Azure-managed rules that protect against common web threats (based on OWASP Core Rule Set). These are easy to deploy and regularly updated by Microsoft.
* **Custom Rules:** Rules you create to handle specific traffic patterns, block certain IP addresses, or apply unique security logic that isn't covered by managed rules. Custom rules are processed *before* managed rules.
* **Exclusions:** Settings to bypass WAF inspection for specific attributes of a request (e.g., a header or cookie) to prevent false positives for legitimate traffic.
* **Modes:**
    * **Detection Mode:** Monitors and logs all detected threats without blocking the requests. Used for testing and tuning.
    * **Prevention Mode:** Blocks intrusions and attacks detected by the rules, sending a "403 unauthorized access" to the client.

A WAF Policy can be associated with the entire **Application Gateway (Global)**, an individual **Listener (Per-site protection)**, or a **Path-based Routing Rule (Per-URI protection)**.

***

## FrontEnd, Routing Rules, and Backend of Application Gateway

The Application Gateway uses a structured flow to process traffic, connecting the client (FrontEnd) to the web servers (Backend) via **Listeners** and **Routing Rules**.

### FrontEnd Configuration
The **FrontEnd** is the public-facing or internal endpoint where the Application Gateway receives client traffic.

| Component | Description |
| :--- | :--- |
| **Frontend IP Address** | The IP address the Application Gateway listens on. It can be a **Public IP** (Internet-facing) or a **Private IP** (internal to a VNet). |
| **Frontend Port** | The port (e.g., 80, 443, or a custom port) on which the gateway accepts inbound client traffic. |

### Routing Rules

**Routing Rules** (or Request Routing Rules) connect the **Listener** to the **Backend Targets** (via Backend Settings). A rule is what determines *how* a request is handled after the Listener receives it.

| Rule Type | Description |
| :--- | :--- |
| **Basic** | Routes all traffic received by the associated listener to a **single** backend pool. |
| **Path-based** | Routes traffic to **different** backend pools based on the **URL path** in the request (e.g., requests to `/images/*` go to the `ImagesBackendPool`, and requests to `/video/*` go to the `VideoBackendPool`). |

### Listener Types

A **Listener** is a logical entity that checks for incoming client connection requests using a specific protocol (HTTP/HTTPS/TLS/TCP), port, host header, and IP address.

| Listener Type | Description |
| :--- | :--- |
| **Basic Listener** | Used when you host a **single website** behind the Application Gateway. It accepts all requests on the configured IP/Port/Protocol combination. |
| **Multi-site Listener** | Used for **hosting multiple websites** on the same Application Gateway instance and public IP address. It uses the **Host Header** or **Host Names** (domain name) in the request to differentiate traffic and direct it to the correct backend pool. |

***

## Backend Targets

**Backend Targets** (also called **Backend Pool Members**) are the destination servers that serve the actual web application content. The Application Gateway forwards client requests to these targets for processing.

| Component | Description |
| :--- | :--- |
| **Backend Pool** | A logical group of backend targets (servers) that the Application Gateway load balances traffic across. |
| **Backend Targets** | The individual servers within a pool. They can be **Virtual Machines (VMs)**, **Virtual Machine Scale Sets (VMSS)**, **IP addresses**, **Fully Qualified Domain Names (FQDNs)**, or **Azure App Service/Function Apps** (multitenant backends). |
| **Backend HTTP Settings** | Defines the parameters for the connection *from* the Application Gateway *to* the backend targets, including: **Port** (e.g., 80 or 443), **Protocol** (HTTP or HTTPS), **Cookie-based Session Affinity**, **Connection Draining**, and **Request Timeout**. |

